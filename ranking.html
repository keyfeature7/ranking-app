<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HotRanking — Einfaches Ranking-Tool</title>
  <style>
    :root{
      --bg:#0f1113; --panel:#121418; --muted:#9aa3ad; --text:#e8eef2;
      --accent:#ff4d3f; --gold:#D4AF37; --silver:#C0C0C0; --bronze:#CD7F32;
      --card:#15181b;
    }

    *{box-sizing:border-box;font-family:Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial}
    body{margin:0;background:linear-gradient(180deg,#0b0c0e 0%, #0f1113 100%);color:var(--text);min-height:100vh;padding:28px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-family: 'Segoe Script', 'Bradley Hand', system-ui; font-weight:700; margin:0; font-size:42px; color:var(--accent)}
    .controls{display:flex;gap:12px;align-items:center}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.6)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}

    .grid{display:grid;grid-template-columns:360px 1fr;gap:16px}

    input[type="text"], input[type="number"], textarea, select{
      background:transparent;border:1px solid rgba(255,255,255,0.08);
      padding:8px;border-radius:8px;color:var(--text);width:100%
    }
    textarea{min-height:120px;resize:vertical}
    button{background:var(--accent);border:none;padding:8px 12px;border-radius:8px;color:white;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}

    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:10px 12px;text-align:left;font-size:15px}
    thead th{position:relative;cursor:pointer;user-select:none}
    thead th .arrow{position:absolute;right:8px;font-size:12px;opacity:.7}
    tbody tr{border-bottom:1px solid rgba(255,255,255,0.03)}
    .rank-num{width:36px}
    .name-col{width:220px}
    .score{width:78px;text-align:center}
    .medal{display:inline-block;width:28px;height:28px;border-radius:50%;line-height:28px;text-align:center;color:#000;font-weight:700}
    .gold{background:var(--gold)}
    .silver{background:var(--silver)}
    .bronze{background:var(--bronze)}

    .small{font-size:13px;color:var(--muted)}
    .top-actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    footer{margin-top:18px;color:var(--muted);font-size:13px}

    @media (max-width:900px){
      .grid{grid-template-columns:1fr;}
      .name-col{width:auto}
    }
  </style>
</head>
<body>
  <header>
    <h1>HotRanking</h1>
    <div class="controls">
      <div class="small">Dark Mode</div>
      <label style="display:inline-block">
        <input id="toggleTheme" type="checkbox" checked />
      </label>
    </div>
  </header>

  <div class="grid">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
        <strong>Einstellungen</strong>
        <div class="small">Scoring: 1–100 pro Kategorie</div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
        <div>
          <label for="cat0">Kategorie 1</label>
          <input id="cat0" type="text" value="Kategorie 1" />
        </div>
        <div>
          <label for="cat1">Kategorie 2</label>
          <input id="cat1" type="text" value="Kategorie 2" />
        </div>
        <div>
          <label for="cat2">Kategorie 3</label>
          <input id="cat2" type="text" value="Kategorie 3" />
        </div>
        <div>
          <label for="cat3">Kategorie 4</label>
          <input id="cat3" type="text" value="Kategorie 4" />
        </div>
      </div>

      <hr style="border:none;height:12px">

      <strong style="display:block;margin-bottom:8px">Objekt hinzufügen</strong>
      <div style="display:grid;gap:8px">
        <input id="objName" type="text" placeholder="Name des Objekts" />
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:8px">
          <input id="s0" type="number" min="1" max="100" placeholder="1–100" />
          <input id="s1" type="number" min="1" max="100" placeholder="1–100" />
          <input id="s2" type="number" min="1" max="100" placeholder="1–100" />
          <input id="s3" type="number" min="1" max="100" placeholder="1–100" />
        </div>

        <div>
          <label for="tagsInput">Schlagwörter (optional)</label>
          <input id="tagsInput" type="text" placeholder="z.B. groß, klein, schnell" />
          <div class="small">Mehrere mit Komma trennen.</div>
        </div>

        <div style="display:flex;gap:8px">
          <button id="addBtn">Objekt hinzufügen</button>
          <button id="clearBtn" style="background:#444">Formular leeren</button>
        </div>
      </div>

      <hr style="border:none;height:12px">

      <strong style="display:block;margin-bottom:8px">Mehrere Objekte importieren (CSV)</strong>
      <div style="display:grid;gap:8px">
        <div class="small">Format: Name,score1,score2,score3,score4,tags (tags optional) pro Zeile</div>
        <textarea id="bulk" placeholder="Beispiel:
Objekt A,80,65,40,55,gross;schnell
Objekt B,50,50,50,50,klein"></textarea>
        <div style="display:flex;gap:8px">
          <button id="importBtn">Importieren</button>
          <button id="sampleBtn" style="background:#444">Beispiel einfügen</button>
        </div>
        <div class="small">Tags können mit Komma oder Semikolon getrennt werden.</div>
      </div>

      <hr style="border:none;height:12px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="exportJson" style="background:#0b84ff">Export JSON</button>
          <button id="clearAll" style="background:#7a2f2f">Alle löschen</button>
        </div>
        <div class="small">Speichert lokal im Browser</div>
      </div>
    </div>

    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Ranking</strong>
        <div class="top-actions">
          <label class="small">Filter Tag</label>
          <select id="tagFilter">
            <option value="all">Alle</option>
          </select>

          <label class="small">Sortieren nach</label>
          <select id="sortSelect">
            <option value="total">Gesamtpunkte</option>
            <option value="cat0">Kategorie 1</option>
            <option value="cat1">Kategorie 2</option>
            <option value="cat2">Kategorie 3</option>
            <option value="cat3">Kategorie 4</option>
            <option value="name">Name</option>
          </select>
          <button id="toggleOrder">↓</button>
        </div>
      </div>

      <div id="tableWrap">
        <table id="rankTable">
          <thead>
            <tr>
              <th class="rank-num">#</th>
              <th class="name-col" data-key="name">Objekt <span class="arrow">⇅</span></th>
              <th class="score" data-key="cat0">Kategorie 1 <span class="arrow">⇅</span></th>
              <th class="score" data-key="cat1">Kategorie 2 <span class="arrow">⇅</span></th>
              <th class="score" data-key="cat2">Kategorie 3 <span class="arrow">⇅</span></th>
              <th class="score" data-key="cat3">Kategorie 4 <span class="arrow">⇅</span></th>
              <th class="score" data-key="total">Gesamt <span class="arrow">⇅</span></th>
              <th style="width:180px">Tags</th>
              <th style="width:120px">Aktionen</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <footer>
        Top 3 werden automatisch mit Gold / Silber / Bronze markiert.
        Sortieren: Dropdown oder Spaltenkopf. Filtern: Tag-Dropdown.
      </footer>
    </div>
  </div>

  <script>
    const categories = [
      document.getElementById('cat0'),
      document.getElementById('cat1'),
      document.getElementById('cat2'),
      document.getElementById('cat3')
    ];

    const storageKey = 'hotranking_data_v2';
    let objs = JSON.parse(localStorage.getItem(storageKey) || '[]');

    let sortKey = 'total';
    let sortDesc = true;
    let tagFilter = 'all';

    const tbody = document.querySelector('#rankTable tbody');
    const sortSelect = document.getElementById('sortSelect');
    const toggleOrder = document.getElementById('toggleOrder');
    const tagSelect = document.getElementById('tagFilter');

    function save() {
      localStorage.setItem(storageKey, JSON.stringify(objs));
    }

    function saveCats() {
      localStorage.setItem(storageKey + '_cats', JSON.stringify(categories.map(c => c.value)));
    }

    function calcTotal(o) {
      return (o.scores || []).reduce((a, b) => a + Number(b || 0), 0);
    }

    function normalizeTags(raw) {
      if (!raw) return [];
      return [...new Set(
        raw
          .split(';').join(',')
          .split(',')
          .map(t => t.trim())
          .filter(Boolean)
          .map(t => t.toLowerCase())
      )];
    }

    function updateTagDropdown() {
      const allTags = new Set();
      objs.forEach(o => (o.tags || []).forEach(t => allTags.add(t)));

      const prev = tagSelect.value || 'all';
      tagSelect.innerHTML = '<option value="all">Alle</option>';

      [...allTags].sort((a, b) => a.localeCompare(b)).forEach(t => {
        const opt = document.createElement('option');
        opt.value = t;
        opt.textContent = t;
        tagSelect.appendChild(opt);
      });

      if ([...tagSelect.options].some(o => o.value === prev)) tagSelect.value = prev;
      else tagSelect.value = 'all';

      tagFilter = tagSelect.value;
    }

    function render() {
      // Header-Kategorien aktualisieren
      document.querySelector('th[data-key="cat0"]').childNodes[0].textContent = categories[0].value + ' ';
      document.querySelector('th[data-key="cat1"]').childNodes[0].textContent = categories[1].value + ' ';
      document.querySelector('th[data-key="cat2"]').childNodes[0].textContent = categories[2].value + ' ';
      document.querySelector('th[data-key="cat3"]').childNodes[0].textContent = categories[3].value + ' ';

      // Totals berechnen
      objs.forEach(o => o.total = calcTotal(o));

      // Tag Dropdown updaten
      updateTagDropdown();

      // Sortieren
      const sorted = [...objs].sort((a, b) => {
        if (sortKey === 'name') {
          return sortDesc ? b.name.localeCompare(a.name) : a.name.localeCompare(b.name);
        }
        const idx = sortKey.startsWith('cat') ? Number(sortKey.slice(3)) : null;
        const va = sortKey === 'total' ? a.total : (a.scores[idx] || 0);
        const vb = sortKey === 'total' ? b.total : (b.scores[idx] || 0);
        return sortDesc ? vb - va : va - vb;
      });

      // Filtern nach Tag
      const filtered = (tagFilter && tagFilter !== 'all')
        ? sorted.filter(o => (o.tags || []).includes(tagFilter))
        : sorted;

      // Tabelle rendern
      tbody.innerHTML = '';
      filtered.forEach((o, i) => {
        const tr = document.createElement('tr');

        const rank = document.createElement('td');
        rank.className = 'rank-num';

        if (i === 0) rank.innerHTML = '<span class="medal gold">1</span>';
        else if (i === 1) rank.innerHTML = '<span class="medal silver">2</span>';
        else if (i === 2) rank.innerHTML = '<span class="medal bronze">3</span>';
        else rank.textContent = (i + 1) + '.';

        const nameTd = document.createElement('td');
        nameTd.className = 'name-col';
        nameTd.textContent = o.name;

        const s0 = document.createElement('td'); s0.className = 'score'; s0.textContent = o.scores[0] ?? 1;
        const s1 = document.createElement('td'); s1.className = 'score'; s1.textContent = o.scores[1] ?? 1;
        const s2 = document.createElement('td'); s2.className = 'score'; s2.textContent = o.scores[2] ?? 1;
        const s3 = document.createElement('td'); s3.className = 'score'; s3.textContent = o.scores[3] ?? 1;

        const totalTd = document.createElement('td');
        totalTd.className = 'score';
        totalTd.textContent = o.total;

        const tagsTd = document.createElement('td');
        tagsTd.className = 'small';
        tagsTd.textContent = (o.tags && o.tags.length) ? o.tags.join(', ') : '—';

        const actions = document.createElement('td');
        actions.style.display = 'flex';
        actions.style.gap = '6px';

        const edit = document.createElement('button');
        edit.textContent = 'Bearbeiten';
        edit.style.background = '#2b6f2b';
        edit.onclick = () => editObject(o.id);

        const del = document.createElement('button');
        del.textContent = 'Löschen';
        del.style.background = '#782020';
        del.onclick = () => {
          if (confirm('Objekt löschen?')) {
            objs = objs.filter(x => x.id !== o.id);
            save();
            render();
          }
        };

        actions.append(edit, del);

        tr.append(rank, nameTd, s0, s1, s2, s3, totalTd, tagsTd, actions);
        tbody.appendChild(tr);
      });
    }

    // Single Add
    document.getElementById('addBtn').onclick = () => {
      const name = document.getElementById('objName').value.trim();
      if (!name) { alert('Bitte Name eingeben'); return; }

      const sc = [
        document.getElementById('s0').value,
        document.getElementById('s1').value,
        document.getElementById('s2').value,
        document.getElementById('s3').value
      ].map(v => Number(v) || 0);

      if (sc.some(v => v < 1 || v > 100)) {
        alert('Punkte müssen zwischen 1 und 100 liegen');
        return;
      }

      const tags = normalizeTags(document.getElementById('tagsInput').value.trim());

      objs.push({
        id: crypto.randomUUID(),
        name,
        scores: sc,
        tags
      });

      save();
      render();

      document.getElementById('objName').value = '';
      document.getElementById('s0').value = '';
      document.getElementById('s1').value = '';
      document.getElementById('s2').value = '';
      document.getElementById('s3').value = '';
      document.getElementById('tagsInput').value = '';
    };

    document.getElementById('clearBtn').onclick = () => {
      document.getElementById('objName').value = '';
      document.getElementById('s0').value = '';
      document.getElementById('s1').value = '';
      document.getElementById('s2').value = '';
      document.getElementById('s3').value = '';
      document.getElementById('tagsInput').value = '';
    };

    // Bulk Import
    document.getElementById('importBtn').onclick = () => {
      const txt = document.getElementById('bulk').value.trim();
      if (!txt) { alert('Textarea ist leer'); return; }

      const lines = txt.split('\n').map(l => l.trim()).filter(Boolean);
      let added = 0;

      for (const ln of lines) {
        const parts = ln.split(',').map(p => p.trim());
        if (parts.length < 5) continue;

        const name = parts[0];
        const sc = parts.slice(1, 5).map(v => Number(v) || 0);
        if (sc.some(v => v < 1 || v > 100)) continue;

        const tagsRaw = parts.slice(5).join(',').trim();
        const tags = normalizeTags(tagsRaw);

        objs.push({
          id: crypto.randomUUID(),
          name,
          scores: sc,
          tags
        });
        added++;
      }

      if (added === 0) alert('Keine gültigen Zeilen gefunden (Format: Name,score1,score2,score3,score4,tags)');
      save();
      render();
    };

    document.getElementById('sampleBtn').onclick = () => {
      document.getElementById('bulk').value =
        'Objekt A,80,65,40,55,gross;schnell\n' +
        'Objekt B,50,50,50,50,klein\n' +
        'Objekt C,100,100,90,95,gross,stark';
    };

    // Sorting
    sortSelect.onchange = (e) => { sortKey = e.target.value; render(); };
    toggleOrder.onclick = () => { sortDesc = !sortDesc; toggleOrder.textContent = sortDesc ? '↓' : '↑'; render(); };

    // Tag filter
    tagSelect.onchange = (e) => { tagFilter = e.target.value; render(); };

    // Clickable headers
    document.querySelectorAll('th[data-key]').forEach(h => {
      h.addEventListener('click', () => {
        const k = h.getAttribute('data-key');
        sortKey = k;
        sortDesc = !sortDesc;
        sortSelect.value = sortKey;
        toggleOrder.textContent = sortDesc ? '↓' : '↑';
        render();
      });
    });

    // Export
    document.getElementById('exportJson').onclick = () => {
      const data = {
        categories: categories.map(c => c.value),
        objects: objs
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'hotranking_export.json';
      a.click();
      URL.revokeObjectURL(url);
    };

    document.getElementById('clearAll').onclick = () => {
      if (confirm('Alle Objekte entfernen?')) {
        objs = [];
        save();
        render();
      }
    };

    // Edit object
    function editObject(id) {
      const o = objs.find(x => x.id === id);
      if (!o) return;

      const name = prompt('Name', o.name);
      if (name === null) return;
      o.name = name.trim() || o.name;

      for (let i = 0; i < 4; i++) {
        const v = prompt('Punkte für ' + categories[i].value + ' (1-100)', o.scores[i] ?? 1);
        if (v === null) return;
        const n = Number(v) || 0;
        if (n < 1 || n > 100) { alert('Ungültige Punktzahl, Abbruch'); return; }
        o.scores[i] = n;
      }

      const tagsStr = prompt('Schlagwörter (Komma getrennt)', (o.tags || []).join(', '));
      if (tagsStr === null) return;
      o.tags = normalizeTags(tagsStr);

      save();
      render();
    }

    // Kategorie-Namen speichern
    categories.forEach(c => c.addEventListener('input', () => { saveCats(); render(); }));

    // init
    (function init() {
      try {
        const catsSaved = JSON.parse(localStorage.getItem(storageKey + '_cats') || 'null');
        if (Array.isArray(catsSaved) && catsSaved.length === 4) {
          categories.forEach((c, i) => c.value = catsSaved[i]);
        }
      } catch (e) {}
      render();
    })();

    // Theme toggle (dark/light simple)
    document.getElementById('toggleTheme').addEventListener('change', (e) => {
      if (e.target.checked) {
        document.body.style.background = 'linear-gradient(180deg,#0b0c0e 0%, #0f1113 100%)';
        document.documentElement.style.setProperty('--text', '#e8eef2');
      } else {
        document.body.style.background = '#f6f7fb';
        document.documentElement.style.setProperty('--text', '#111');
      }
    });
  </script>
</body>
</html>
